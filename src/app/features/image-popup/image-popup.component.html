<div class="image-popup-overlay" (click)="onOverlayClick($event)">
  <div class="image-popup-container" (click)="$event.stopPropagation()">
    <!-- Header -->
    <div class="popup-header">
      <div class="popup-title">
        <h3>Frame {{ frameNumber }} - {{ sequenceName }}</h3>
        <p class="scenario-info">
          {{ scenarioName }}: 
          <span [class.present]="scenarioPresence" [class.absent]="!scenarioPresence">
            {{ scenarioPresence ? 'Present' : 'Absent' }}
          </span>
        </p>
      </div>
      <button mat-icon-button (click)="onClose()" class="close-button">
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <!-- Image Container -->
    <div class="image-container">
      <div class="image-wrapper" 
           [style.transform]="getImageTransform()"
           [style.transition]="isTransitioning ? 'transform 0.3s ease' : 'none'">
        <img 
          [src]="imagePath" 
          [alt]="'Frame ' + frameNumber"
          class="popup-image"
          (load)="onImageLoad()"
          (error)="onImageError()">
      </div>

      <!-- Loading Overlay -->
      <div class="loading-overlay" *ngIf="isLoading">
        <mat-spinner diameter="60"></mat-spinner>
        <p>Loading image...</p>
      </div>

      <!-- Error State -->
      <div class="error-overlay" *ngIf="hasError">
        <mat-icon class="error-icon">error</mat-icon>
        <p>Failed to load image</p>
        <button mat-stroked-button color="primary" (click)="retryLoad()">
          <mat-icon>refresh</mat-icon>
          Retry
        </button>
      </div>
    </div>

    <!-- Controls -->
    <div class="popup-controls">
      <!-- Zoom Controls -->
      <div class="control-group">
        <span class="control-label">Zoom:</span>
        <button 
          mat-icon-button 
          (click)="zoomOut()"
          [disabled]="zoomLevel <= minZoom"
          matTooltip="Zoom Out">
          <mat-icon>zoom_out</mat-icon>
        </button>
        <span class="zoom-display">{{ (zoomLevel * 100) | number:'1.0-0' }}%</span>
        <button 
          mat-icon-button 
          (click)="zoomIn()"
          [disabled]="zoomLevel >= maxZoom"
          matTooltip="Zoom In">
          <mat-icon>zoom_in</mat-icon>
        </button>
        <button 
          mat-stroked-button 
          (click)="resetZoom()"
          class="reset-button">
          Reset
        </button>
      </div>

      <!-- Rotation Controls -->
      <div class="control-group">
        <span class="control-label">Rotate:</span>
        <button 
          mat-icon-button 
          (click)="rotateLeft()"
          matTooltip="Rotate Left">
          <mat-icon>rotate_left</mat-icon>
        </button>
        <span class="rotation-display">{{ rotation }}Â°</span>
        <button 
          mat-icon-button 
          (click)="rotateRight()"
          matTooltip="Rotate Right">
          <mat-icon>rotate_right</mat-icon>
        </button>
        <button 
          mat-stroked-button 
          (click)="resetRotation()"
          class="reset-button">
          Reset
        </button>
      </div>

      <!-- Pan Controls (when zoomed) -->
      <div class="control-group" *ngIf="zoomLevel > 1">
        <span class="control-label">Pan:</span>
        <button 
          mat-stroked-button 
          (click)="resetPan()"
          class="reset-button">
          Center Image
        </button>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="popup-actions">
      <button mat-stroked-button (click)="onClose()">
        Close
      </button>
      <button mat-raised-button color="primary" (click)="downloadImage()">
        <mat-icon>download</mat-icon>
        Download
      </button>
    </div>
  </div>
</div>