<mat-card class="timeline-card">
  <mat-card-header>
    <mat-card-title>Timeline Viewer</mat-card-title>
    <mat-card-subtitle *ngIf="!selectedSequence || !selectedScenario">
      Select a sequence and scenario to view the timeline
    </mat-card-subtitle>
    <mat-card-subtitle *ngIf="selectedSequence && selectedScenario">
      {{ selectedScenario?.name }} presence in "{{ selectedSequence.name }}"
    </mat-card-subtitle>
  </mat-card-header>

  <mat-card-content>
    <!-- No Data State -->
    <div class="no-data-state" *ngIf="!selectedSequence || !selectedScenario">
      <mat-icon class="no-data-icon">timeline</mat-icon>
      <p class="no-data-text">Please select both a sequence and scenario to view the timeline</p>
    </div>

    <!-- Loading State -->
    <div class="loading-state" *ngIf="isLoading && selectedSequence && selectedScenario">
      <mat-spinner diameter="40"></mat-spinner>
      <p class="loading-text">Loading timeline data...</p>
    </div>

    <!-- Timeline Content -->
    <div class="timeline-container" *ngIf="timelineData && !isLoading">
      <!-- Controls -->
      <div class="timeline-controls">
        <div class="zoom-controls">
          <button 
            mat-icon-button 
            (click)="zoomOut()"
            [disabled]="zoomLevel <= minZoom"
            matTooltip="Zoom Out"
            class="zoom-button">
            <mat-icon>zoom_out</mat-icon>
          </button>

          <span class="zoom-level">{{ (zoomLevel * 100) | number:'1.0-0' }}%</span>

          <button 
            mat-icon-button 
            (click)="zoomIn()"
            [disabled]="zoomLevel >= maxZoom"
            matTooltip="Zoom In"
            class="zoom-button">
            <mat-icon>zoom_in</mat-icon>
          </button>
        </div>

        <!-- Scroll Controls -->
        <div class="scroll-controls">
          <button 
            mat-icon-button 
            (click)="scrollTimeline('left')" 
            matTooltip="Scroll Left"
            class="scroll-button">
            <mat-icon>arrow_back</mat-icon>
          </button>
          <button 
            mat-icon-button 
            (click)="scrollTimeline('right')" 
            matTooltip="Scroll Right"
            class="scroll-button">
            <mat-icon>arrow_forward</mat-icon>
          </button>
        </div>

        <div class="timeline-info">
          <span class="frame-count">{{ timelineData.frames.length }} frames</span>
          <span class="total-frames">Total: {{ timelineData.totalFrames }}</span>
        </div>

        <!-- Legend -->
        <div class="legend">
          <div class="legend-item">
            <div class="legend-color present"></div>
            <span>{{ selectedScenario?.name }} Present</span>
          </div>
          <div class="legend-item">
            <div class="legend-color absent"></div>
            <span>{{ selectedScenario?.name }} Absent</span>
          </div>
        </div>
      </div>

      <!-- Scrollable Timeline -->
      <div class="timeline-scroll-container" #scrollContainer>
        <div 
          class="timeline-track" 
          [style.width.px]="timelineWidth">

          <!-- Frame Items -->
          <div 
            *ngFor="let frame of timelineData.frames; trackBy: trackByFrame"
            class="timeline-frame"
            [class.scenario-present]="frame.scenarioPresence"
            [class.scenario-absent]="!frame.scenarioPresence"
            [class.selected]="selectedFrameNumber === frame.frameNumber"
            [style.width.px]="frameWidth"
            (click)="onFrameClick(frame.frameNumber)"
            [matTooltip]="'Frame ' + frame.frameNumber + ' (' + frame.timestamp + ')'"
            matTooltipPosition="above"
            matTooltipShowDelay="300">

            <!-- Frame Thumbnail -->
            <div class="frame-thumbnail">
              <img 
                [src]="frame.thumbnailUrl" 
                [alt]="'Frame ' + frame.frameNumber"
                class="thumbnail-image"
                loading="lazy">

              <!-- Frame Number Overlay -->
              <div class="frame-number-overlay">
                {{ frame.frameNumber }}
              </div>

              <!-- Scenario Indicator -->
              <div class="scenario-indicator">
                <mat-icon class="indicator-icon">
                  {{ frame.scenarioPresence ? 'check_circle' : 'cancel' }}
                </mat-icon>
              </div>
            </div>

            <!-- Timeline Marker -->
            <div class="timeline-marker"></div>
          </div>
        </div>
      </div>

      <!-- Timeline Scale -->
      <div class="timeline-scale">
        <div 
          *ngFor="let frame of getScaleMarkers()"
          class="scale-marker"
          [style.left.px]="getScalePosition(frame.frameNumber)">
          <div class="scale-tick"></div>
          <span class="scale-label">{{ frame.timestamp }}</span>
        </div>
      </div>
    </div>

    <!-- Error State -->
    <div class="error-state" *ngIf="hasError && !isLoading">
      <mat-icon class="error-icon">error</mat-icon>
      <p class="error-text">Failed to load timeline data</p>
      <button mat-stroked-button color="primary" (click)="loadTimelineData()">
        <mat-icon>refresh</mat-icon>
        Retry
      </button>
    </div>
  </mat-card-content>
</mat-card>