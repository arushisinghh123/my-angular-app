<mat-card class="viewer-card">
  <mat-card-header>
    <mat-card-title>Frame Image Viewer</mat-card-title>

    <mat-form-field appearance="fill" *ngIf="selectedSequence" class="frame-input">
      <mat-label>Enter Frame Number</mat-label>
      <input matInput type="number" [(ngModel)]="pendingFrameNumber" />
    </mat-form-field>

    <button mat-raised-button color="primary" (click)="loadSelectedFrame()" [disabled]="pendingFrameNumber === null">
      Go
    </button>

    <mat-card-subtitle *ngIf="!confirmedFrameNumber">
      Select a frame number and click Go to view the image
    </mat-card-subtitle>

    <mat-card-subtitle *ngIf="confirmedFrameNumber && selectedSequence">
      Frame {{ confirmedFrameNumber }} from "{{ selectedSequence.name }}"
    </mat-card-subtitle>
  </mat-card-header>

  <mat-card-content>
    <!-- No Frame Selected State -->
    <div class="no-frame-state" *ngIf="!confirmedFrameNumber || !selectedSequence">
      <mat-icon class="no-frame-icon">photo</mat-icon>
      <p class="no-frame-text">Please select a sequence and frame number to view the image</p>
    </div>

    <!-- Loading State -->
    <div class="loading-state" *ngIf="isLoading && confirmedFrameNumber && selectedSequence">
      <mat-spinner diameter="60"></mat-spinner>
      <p class="loading-text">Loading frame {{ confirmedFrameNumber }}...</p>
    </div>

    <!-- Error State -->
    <div class="error-state" *ngIf="hasError && !isLoading">
      <mat-icon class="error-icon">error</mat-icon>
      <p class="error-text">Failed to load frame image</p>
      <button mat-stroked-button color="primary" (click)="retryLoad()">
        <mat-icon>refresh</mat-icon>
        Retry
      </button>
    </div>

    <!-- Image Display -->
    <div class="image-container" *ngIf="confirmedFrameNumber !== null && frameMetadata && !isLoading && !hasError">
      <div class="image-wrapper">
        <img 
          [src]="frameMetadata.imagePath" 
          [alt]="'Frame ' + frameMetadata.frameNumber + ' from ' + frameMetadata.sequenceName"
          class="frame-image"
          (load)="onImageLoad()"
          (error)="onImageError()">
        
        <!-- Image Overlay Info -->
        <div class="image-overlay">
          <div class="overlay-info">
            <span class="frame-info">Frame {{ frameMetadata.frameNumber }}</span>
            <span class="timestamp-info" *ngIf="frameMetadata.timestamp">
              {{ frameMetadata.timestamp }}
            </span>
          </div>
        </div>
      </div>

      <!-- Metadata Section -->
      <div class="metadata-section">
        <h3 class="metadata-title">Frame Metadata</h3>
        
        <div class="metadata-grid">
          <div class="metadata-item">
            <mat-icon class="metadata-icon">playlist_play</mat-icon>
            <div class="metadata-content">
              <span class="metadata-label">Sequence</span>
              <span class="metadata-value">{{ frameMetadata.sequenceName }}</span>
            </div>
          </div>

          <div class="metadata-item">
            <mat-icon class="metadata-icon">photo</mat-icon>
            <div class="metadata-content">
              <span class="metadata-label">Frame Number</span>
              <span class="metadata-value">{{ frameMetadata.frameNumber }}</span>
            </div>
          </div>

          <div class="metadata-item">
            <mat-icon class="metadata-icon">schedule</mat-icon>
            <div class="metadata-content">
              <span class="metadata-label">Timestamp</span>
              <span class="metadata-value">{{ frameMetadata.timestamp || 'N/A' }}</span>
            </div>
          </div>

          <div class="metadata-item">
            <mat-icon 
              class="metadata-icon"
              [class.scenario-present]="frameMetadata.scenarioPresence"
              [class.scenario-absent]="!frameMetadata.scenarioPresence">
              {{ frameMetadata.scenarioPresence ? 'check_circle' : 'cancel' }}
            </mat-icon>
            <div class="metadata-content">
              <span class="metadata-label">Scenario Presence</span>
              <span 
                class="metadata-value scenario-status"
                [class.present]="frameMetadata.scenarioPresence"
                [class.absent]="!frameMetadata.scenarioPresence">
                {{ frameMetadata.scenarioPresence ? 'Yes' : 'No' }}
              </span>
            </div>
          </div>

          <div class="metadata-item" *ngIf="frameMetadata.confidence">
            <mat-icon class="metadata-icon">analytics</mat-icon>
            <div class="metadata-content">
              <span class="metadata-label">Confidence</span>
              <span class="metadata-value">{{ (frameMetadata.confidence * 100) | number:'1.0-1' }}%</span>
            </div>
          </div>
        </div>

        <!-- Scenario Chip -->
        <div class="scenario-chip-container" *ngIf="selectedScenario">
          <mat-chip-listbox>
            <mat-chip-option 
              [selected]="frameMetadata.scenarioPresence"
              [class.scenario-present]="frameMetadata.scenarioPresence"
              [class.scenario-absent]="!frameMetadata.scenarioPresence">
              <mat-icon>{{ selectedScenario.name.toLowerCase() === 'tunnel' ? 'tunnel' : 'folder' }}</mat-icon>
              {{ selectedScenario.name }}
              <span class="chip-status">
                ({{ frameMetadata.scenarioPresence ? 'Present' : 'Absent' }})
              </span>
            </mat-chip-option>
          </mat-chip-listbox>
        </div>
      </div>
    </div>
  </mat-card-content>
</mat-card>